# the list of background files depends on whether we're using ice
_: &bkg_files_ocn
    ocn_filename: MOM.res.nc
_: &bkg_files_ocn_ice
    ice_filename: cice.res.nc
    << : *bkg_files_ocn
_: &bkg_files *bkg_files___DOMAINS__

# the list of correlation operators depends on whether we're using ice
_corr:
  - &corr_ocn {name: ocn, variables: [__DA_VARIABLES_OCN__]}
  - &corr_ice {name: ice, variables: [__DA_VARIABLES_ICE__]}
  - &corr_list_ocn [ *corr_ocn ]
  - &corr_list_ocn_ice [ *corr_ocn , *corr_ice ]

geometry:
  mom6_input_nml: mom_input.nml
  fields metadata: fields_metadata.yaml


# TODO Use appropriate date, somebody is abusing the lack of error traps
#      in soca!
model:
  name: PseudoModel
  tstep: PT6H
  state variables: &state_vars [__DA_VARIABLES__, mld, layer_depth]
  states:
  - date: 2018-04-15T06:00:00Z
    read_from_file: 1
    basename: ./RESTART_IN/
    << : *bkg_files

initial condition:
  read_from_file: 1
  date: &date 2018-04-15T00:00:00Z
  basename: ./RESTART_IN/
  << : *bkg_files
  state variables: &state_vars [__DA_VARIABLES__, mld, layer_depth]

background error:
  covariance model: SABER
  saber blocks:
  - saber block name: BUMP_NICAS
    saber central block: true
    iterative inverse: true
    input variables: &soca_vars [ __DA_VARIABLES__ ]
    output variables: *soca_vars
    bump:
      verbosity: main
      datadir: ./bump
      strategy: specific_univariate
      load_nicas_local: true
      grids:
      - prefix: bump3d
        variables: [hocn, socn, tocn, chl]
      - prefix: bump2d
        variables: [ssh, cicen, hicen, hsnon]

  linear variable change:
    input variables: *soca_vars
    output variables: *soca_vars
    linear variable changes:

    - linear variable change name: BkgErrFILT
      ocean_depth_min: 0    # [m]
      rescale_bkgerr: 1.0
      efold_z: 2500.0       # [m]

    - linear variable change name: BkgErrGODAS
      t_min: 0.1
      t_max: 2.0
      t_dz:  20.0
      t_efold: 500.0
      s_min: 0.0
      s_max: 0.25
      ssh_min: 0.0   # value at EQ
      ssh_max: 0.0   # value in Extratropics
      ssh_phi_ex: 20 # lat of transition from extratropics
      chl_min: 0.003
      chl_max: 10.0
      biop_min: 0.0
      biop_max: 1.0e-6
      cicen_min: 0.05
      cicen_max: 0.05
      hicen_min: 0.1
      hicen_max: 0.1

    - linear variable change name: BalanceSOCA
      dsdtmax: 0.1
      dsdzmin: 3.0e-6
      dtdzmin: 1.0e-6
      nlayers: 10

members: #DA_ENS_SIZE#
perturbed variables: *soca_vars
forecast length: PT6H

output:
 frequency: PT6H
 datadir: Data
 exp: pert
 type: ens
 date: *date
